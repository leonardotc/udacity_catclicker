<html>
  <head>
    <title>Coursera Training</title>
    <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/bootstrap-theme.min.css">
<script src="js/jquery-1.12.4.min.js"></script>
<script src="js/bootstrap.min.js"></script>
  </head>
  <body>
    <div class="col-sm-12">
      <div class="list-container col-sm-4">
        <ul id="cat-list"></ul>
      </div>
      <div class="col-sm-8">
        <div id="cat-container">
          <!-- to be populated by the selected cat attributes -->
        </div>
      </div>
    </div>
  </body>
  <script>
    $(function() {
    
      var catsModel = {
        init: function() {
          if (!localStorage.selectedCatName) {
            localStorage.selectedCatName = 'Marcelo';
          }
          if (!localStorage.cats) {
            localStorage.cats = JSON.stringify([
              {total: 0, name: 'Marcelo', img:'img/blueboy3.jpg'},
              {total: 0, name: 'Doris Clone', img:'img/blueboy4.jpg'},
              {total: 0, name: 'Kid Kat', img:'img/blueboy5.jpg'},
              {total: 0, name: 'Packed Cat', img:'img/blueboy6.jpg'},
              {total: 0, name: 'Bath Cat', img:'img/blueboy7.jpg'}]);
          }
        },
        
        getSelectedCat: function() {
          return this.getCatByName(localStorage.selectedCatName);
        },
        
        selectCat: function(cat) {
          localStorage.selectedCatName = cat.name;
        },
        
        getCats: function() {
          return JSON.parse(localStorage.cats);
        },
        
        updateCatList: function(list) {
         localStorage.cats = JSON.stringify(list);
        },
        
        updateCounter: function() {
          var catName = localStorage.selectedCatName;
          
          var cats = JSON.parse(localStorage.cats);          
          for (cat in cats) {
            if (cats[cat].name === catName) {
              cats[cat].total++;
            }
          }
          this.updateCatList(cats);
        },
        
        getCatByName: function(name) {
          var cats = JSON.parse(localStorage.cats);
          for (cat in cats) {
            if (cats[cat].name === name) {
              return cats[cat];
            }
          }
          return {}
        }
      }
      
      var octopus = {
        init: function() {
          catsModel.init();
          catsView.init();
        },
        
        getCats: function() {
          return catsModel.getCats();
        },
        
        selectCat: function(cat) {
          catsModel.selectCat(cat);
          catsView.renderCat();
        },
        
        getSelectedCat: function() {
          return catsModel.getSelectedCat();
        },
        
        count: function() {
          catsModel.updateCounter();
          catsView.renderCat();
        }
      }
      
      var catsView = {
        init: function() {
          this.catList = $('#cat-list');
          this.catNode = $('#cat-container');
          this.renderList();
          this.renderCat();
        },
        
        renderList: function() {
          var self = this;
        
          self.catList.html( '' );
          octopus.getCats().forEach(function(cat) {
          
            var el = $(document.createElement("li"));
            self.catList.append(el);
            el.text(cat.name);
            
            el.click(function(e) {
              octopus.selectCat(cat);
            });
          });
        },
        
        renderCat: function() {
          var cat = octopus.getSelectedCat();
          var htmlStr = '';
          
          htmlStr += '<table>' + 
                     '<td><tr><h2>'+ cat.name +'</h2></tr></td>' +
                     '<td><tr><img src="'+ cat.img +'" id="active-cat"></h1></tr></td>' +
                     '<td><tr><p>'+ cat.total +'</p></tr></td></table>';
          this.catNode.html( htmlStr );
          
          $("#active-cat").click(function() {
            octopus.count();
          });
          
        }

      }
      
      octopus.init();
    });
    </script>
</html>